{% load staticfiles %}
<!DOCTYPE>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>Maharashtra Pothole Map</title>

    <link rel="stylesheet" href="{% static "web/bootstrap-3.3.7/css/bootstrap.css" %}">
    <style type="text/css">
        body {
            margin: 0;
            padding: 10px 20px 20px;
            font-family: Arial;
            font-size: 16px;
        }

        #map-container {
            padding: 6px;
            border-width: 1px;
            border-style: solid;
            border-color: #ccc #ccc #999 #ccc;
            -webkit-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
            -moz-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
            box-shadow: rgba(64, 64, 64, 0.1) 0 2px 5px;
        {#        width: 600px;#}
        }

        #map {
        {#        width: 600px;#} height: 800px;
        }

    </style>

    {% comment %}
      key=AIzaSyDZ_hgqAqW-IbDITHKykRm2uq7boVU1dlE
      {% endcomment %}
    <script type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDZ_hgqAqW-IbDITHKykRm2uq7boVU1dlE&lib&libraries=places"></script>
    {% block data %}
        <script type="text/javascript" src="/media/data/data1.js"></script>
    {% endblock %}
    <script type="text/javascript" src="{% static "web/js/markerclusterer/src/markerclusterer.js" %}"></script>
    <script type="text/javascript" src="{% static "web/js/StyledMarker.js" %}"></script>
    <script type="text/javascript" src="{% static "web/js/helper.js" %}"></script>

    {% block draw_map %}

        <script type="text/javascript">
            var map;
            var infoWin;
            function initialize() {
                var center = new google.maps.LatLng(19.0760, 72.8777);

                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 12,
                    center: center,
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                });
                infoWin = new google.maps.InfoWindow();


                var markers = data.map(function (location, i) {
                    // location [lat,lon,accuracy,speed,bearing]
                    var latLng = new google.maps.LatLng(location[0],
                        location[1]);

                    var marker = new google.maps.Marker({
                        position: latLng
                    });

                    // location [lat,lon,accuracy,speed,bearing]
                    google.maps.event.addListener(marker, 'click', function (evt) {
                        var content = "speed = " + location[3].toFixed(2) + " kmph<br>" +
                            "accuracy = " + location[2] + " m<br>" +
                            "bearing = " + location[4] +"<br>" +
                            "reporter_id = " + location[5]+"<br>" +
                            "trip_id = " + location[6];
                        infoWin.setContent(content);
                        infoWin.open(map, marker);
                    })
                    return marker;
                });
                var options = {
                    imagePath: '{% static "web/js/markerclusterer/images/m" %}'
                };
                var markerCluster = new MarkerClusterer(map, markers, options);
            }
            google.maps.event.addDomListener(window, 'load', initialize);
        </script>
    {% endblock %}

</head>
<body>
<h3>Maharashtra Pothole map</h3>
<h2></h2>
<label for="search">Find your place</label>
<input name="search" id="searchTextField" type="text" size="50">
<div id="map-container">
    <div id="map">
    </div>
</div>
</div>
<script type="text/javascript" src="{% static "web/js/jquery-3.1.0.js" %}"></script>
{% block heading %}
    <script type="text/javascript">
        $(document).ready(function () {
            $("h2").text("Total unclustered pothole count " + data.length)
        });
    </script>
{% endblock %}
<script type="text/javascript">
    function initialize() {
        var input = document.getElementById('searchTextField');
        var autocomplete = new google.maps.places.Autocomplete(input);
        // Bind the map's bounds (viewport) property to the autocomplete object,
        // so that the autocomplete requests use the current map bounds for the
        // bounds option in the request.
        autocomplete.bindTo('bounds', map);

        autocomplete.addListener('place_changed', function () {

            infoWin.close();
            var place = autocomplete.getPlace();
            if (!place.geometry) {
                // User entered the name of a Place that was not suggested and
                // pressed the Enter key, or the Place Details request failed.
                window.alert("No details available for input: '" + place.name + "'");
                return;
            }

            // If the place has a geometry, then present it on a map.
            if (place.geometry.viewport) {
                map.fitBounds(place.geometry.viewport);
            } else {
                map.setCenter(place.geometry.location);
                map.setZoom(17);  // Why 17? Because it looks good.
            }
        });
    }
    google.maps.event.addDomListener(window, 'load', initialize);
</script>
</body>
</html>
