{% extends 'web/base.html' %}
{% load staticfiles %}

{% block data %}
    <script type="text/javascript" src="/media/data/pothole_pred.js"></script>
{% endblock %}

{% block draw_map %}
    <script type="text/javascript">
{#    console.log(data)#}

        var map;
        var infoWin;
        function initialize() {
            var center = new google.maps.LatLng(19.0760, 72.8777);

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: center,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                scaleControl: true
            });
            infoWin = new google.maps.InfoWindow();

            var markers = data.map(function (location, i) {
                // location [lat,lon,bearing,grid_id,direction,cluster_size]
{#                console.log(i)#}
                var latLng = new google.maps.LatLng(location[0],
                    location[1]);
                var bearing = location[2];
                var speed = location[3];
                var intensity = location[6];
                var trip_id = location[7];

                var colorString = (intensity >= 0) ? "ff0000" : "00ff00";
                var styleIconClass = new StyledIcon(StyledIconTypes.CLASS, {color: "#" + colorString});

                var direction = getDirectionText(bearing);
                var marker = new StyledMarker({
                    styleIcon: new StyledIcon(StyledIconTypes.MARKER, {text: direction}, styleIconClass),
                    position: latLng,
                });

                // location [lat,lon,bearing]
                google.maps.event.addListener(marker, 'click', function (evt) {
                    var content =
                        "bearing = " + bearing + "<br>" +
                        "speed = " + speed + " kmph<br>" +
                        "intensity = " + intensity + "<br>" +
                        "trip_id = " + trip_id;

                    infoWin.setContent(content);
                    infoWin.open(map, marker);
                })
                return marker;
            });
            var options = {
                imagePath: '{% static "web/js/markerclusterer/images/m" %}',
                maxZoom: 17
            };
            var markerCluster = new MarkerClusterer(map, markers, options);
        }
        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
{% endblock %}

{% block heading %}
    <script type="text/javascript">
        $(document).ready(function () {
            $("h2").text("Pothole counter " + data.length)
        });
    </script>
{% endblock %}

